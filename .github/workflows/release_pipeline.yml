name: Release Pipeline

on:
    push:
        tags:
            - v*

jobs:
    ci:
        if: always() && contains(needs.*.result, 'skipped')
        name: "CI"
        uses: mmenanno/lunchmoney/.github/workflows/ci.yml@main
        secrets: inherit
    release:
        needs: ci
        if: always() && !contains(needs.*.result, 'failed') && !contains(needs.*.result, 'cancelled')
        name: "Release"
        uses: mmenanno/lunchmoney/.github/workflows/publish_gem.yml@main
        secrets: inherit
